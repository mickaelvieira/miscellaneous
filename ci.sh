#!/bin/bash

SITE_REPO="."

carry_on() {

    echo ""
    read -e -p "Do you want to carry on? [Y/n]: " confirminfo

    if [[ ${confirminfo} == "n" ]]; then
        echo "Interrupted!"
        exit
    fi
}


cd ${SITE_REPO}

echo -e "\e[34m"
echo -e "================================================================================================================="
echo -e "                                            PHP Code Sniffer                                                     "
echo -e "================================================================================================================="
echo -e "\e[39m"

PHPCS_ERROR=$(./bin/phpcs --standard=PSR2 ./protected/library/)

echo -e "${PHPCS_ERROR}"

if [[ -n "${PHPCS_ERROR}" ]]; then

    echo ""
    read -e -p "Do you want run PHP Code Beautifier and Fixer? [y/N]: " confirminfo

    if [[ ${confirminfo} == "y" ]]; then
        ./bin/phpcbf --standard=PSR2 ./protected/library/
    fi
fi

carry_on

echo -e "\e[34m"
echo -e "================================================================================================================="
echo -e "                                                 PHPSpec                                                         "
echo -e "================================================================================================================="
echo -e "\e[39m"

./bin/phpspec run --format=pretty

carry_on

echo -e "\e[34m"
echo -e "================================================================================================================="
echo -e "                                          PHP Security Checker                                                   "
echo -e "================================================================================================================="
echo -e "\e[39m"

./bin/security-checker security:check

carry_on

echo -e "\e[34m"
echo -e "================================================================================================================="
echo -e "                                                  JSLint                                                         "
echo -e "================================================================================================================="
echo -e "\e[39m"

gulp jshint

carry_on

echo -e "\e[34m"
echo -e "================================================================================================================="
echo -e "                                                  ESLint                                                         "
echo -e "================================================================================================================="
echo -e "\e[39m"

NODE_ENV=development gulp eslint

carry_on

echo -e "\e[34m"
echo -e "================================================================================================================="
echo -e "                                              JS Code Sniffer                                                    "
echo -e "================================================================================================================="
echo -e "\e[39m"

gulp jscs

carry_on

echo -e "\e[34m"
echo -e "================================================================================================================="
echo -e "                                                   Jasmine                                                       "
echo -e "================================================================================================================="
echo -e "\e[39m"

gulp test

echo -e "\nDone!"
